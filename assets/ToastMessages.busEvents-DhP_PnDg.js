var e=(e,t)=>{console.error(`Error in EventBus for event type: ${String(e)}`,t)};const t={createEvent:(e=Symbol(`event`))=>({type:e,emit:t=>({type:e,payload:t}),match:t=>t.type===e}),...new class{#e=[];#t=new Map;#n=new WeakMap;#r=new Map;constructor({middlewares:t}={}){this.on=(t,n,r={})=>{let{signal:i,replayLast:a=!1}=r;if(i?.aborted===!0)return()=>{};let o=typeof t==`object`?t.type:t,s=this.#t.get(o);s===void 0&&(s=new Set,this.#t.set(o,s));let c=n;i!==void 0&&(c=e=>{if(i.aborted!==!0)return n(e)},this.#n.set(n,c)),s.add(c);let l=()=>{s?.delete(c),i!==void 0&&this.#n.delete(n)};if(i?.addEventListener(`abort`,l,{once:!0}),a){let t=this.#r.get(o);if(t)try{n(t.payload)}catch(t){e(o,t)}}return l},this.off=(e,t)=>{let n=typeof e==`object`?e.type:e,r=this.#t.get(n);if(!r)return;let i=this.#n.get(t);i?(r.delete(i),this.#n.delete(t)):r.delete(t)},this.use=e=>(Array.isArray(e)?this.#e.push(...e):this.#e.push(e),()=>{this.removeMiddleware(e)}),this.removeMiddleware=e=>{Array.isArray(e)?this.#e=this.#e.filter(t=>!e.includes(t)):this.#e=this.#e.filter(t=>t!==e)},this.emit=(t,n)=>{let r,i;typeof t==`object`?`emit`in t?(i=t.emit(n),r=t.type):(i=t,r=t.type):(r=t,i={type:r,payload:n}),r!=null&&(this.#i(i,()=>{this.#t.get(r)?.forEach(t=>{try{t(i.payload)}catch(t){e(r,t)}})}),this.#r.set(r,i))},t!==void 0&&Array.isArray(t)&&this.#e.push(...t)}#i=(e,t)=>{let n=0,r=()=>{let i=this.#e[n++];if(i!==void 0)try{i(e,r)}catch(t){console.error(`Error in middleware for event type: ${String(e.type)}`,t),r()}else t()};r()}}},n=t.createEvent(),r=t.createEvent();export{n,t as r,r as t};