import{N as e,R as t,j as n,k as r,z as i}from"./chunk-JZWAC4HX-pontpNwO.js";import"./ToastMessages.busEvents-DhP_PnDg.js";import{t as a}from"./jsx-runtime-Dg8orHAx.js";import"./Svg-Boi9_9HN.js";import{t as o}from"./useRootLoaderData-DQMeRxtp.js";import{n as s,r as c,t as l}from"./FullscreenModalButtons-C81AW3dn.js";import{o as u,t as d}from"./packages-TGpPiuli.js";import{t as f}from"./ItemCard-sX9X9Rp8.js";import{t as p}from"./Input-Cb6DeJHz.js";import{t as m}from"./formatLocalDate-CRv1zltC.js";import"./Button-B34oQnwm.js";import{t as h}from"./clients-CSXVs_1P.js";var g=a(),_=i();const v=async({params:e})=>{let{id:t}=e;if(!t)throw new Response(`Package ID is required`,{status:400});let n=await d.getById(t);if(!n)throw new Response(`Package not found`,{status:404});return{packageData:n,client:await h.getById(n.clientId)}};var y=t(()=>{let{packageData:t,client:i}=n(),a=e(),{now:d}=o(),{data:h,state:v,reset:y,Form:b}=r(),[x,S]=(0,_.useState)(d),C=v!==`idle`,w=C||!x;return(0,_.useEffect)(()=>{!C&&h&&!h.error&&c.message({type:`success`,message:`Пакет успешно обновлен`}),h?.error&&c.message({type:`error`,message:`Что-то пошло не так`,details:`Пожалуйста попробуйте снова`}),h&&a(-1)},[C,h,y,a,v]),(0,g.jsxs)(b,{action:`/reports/packages`,method:`post`,children:[(0,g.jsx)(`input`,{type:`hidden`,name:`actionType`,value:`createOrUpdate`}),(0,g.jsx)(`input`,{type:`hidden`,name:`clientId`,value:t.clientId}),(0,g.jsx)(`input`,{type:`hidden`,name:`packageId`,value:t.id}),(0,g.jsxs)(u,{children:[(0,g.jsx)(s,{color:`secondary`,children:`Редактирование пакета`}),(0,g.jsxs)(f,{children:[i&&(0,g.jsx)(`div`,{children:i.name}),(0,g.jsx)(p,{type:`date`,name:`date`,label:`Дата посещения *`,required:!0,defaultValue:m(new Date(x)),onChange:e=>{S(new Date(e.target.value).getTime())}}),(0,g.jsx)(p,{label:`Стоимость пакета (₽) *`,type:`number`,name:`cost`,required:!0,min:`0`,step:`1`,placeholder:`13000`,defaultValue:t.cost}),(0,g.jsx)(p,{label:`Количество тренировок *`,type:`number`,name:`totalSessions`,required:!0,min:`1`,step:`1`,defaultValue:t.totalSessions}),(0,g.jsx)(p,{label:`Остаток тренировок в пакете`,type:`number`,name:`remainingSessions`,min:`1`,step:`1`,defaultValue:t.remainingSessions})]})]}),(0,g.jsx)(l,{onClose:()=>a(-1),disabled:w,closeLabel:`Отмена`,submitLabel:`Отметить`})]})});export{v as clientLoader,y as default};